<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
        "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
 <title>Example Documentation</title>
 <link rel="stylesheet" href="tutorial.css" type="text/css">
</head>
<body>

<div class="main">

<!-- doxygen-header.html ends here -->
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>reread.c</h1><pre><div class="fragment"><span class="preprocessor">#include "<a class="code" href="confuse_8h.html">confuse.h</a>"</span>
<span class="preprocessor">#include &lt;string.h&gt;</span>
<span class="preprocessor">#include &lt;signal.h&gt;</span>
<span class="preprocessor">#include &lt;unistd.h&gt;</span>

<a name="_a0"></a><a class="code" href="structcfg__t.html">cfg_t</a> *cfg = 0;
<span class="keyword">const</span> <span class="keywordtype">char</span> *config_filename = <span class="stringliteral">"./reread.conf"</span>;

<span class="keywordtype">void</span> read_config(<span class="keywordtype">void</span>)
{
    <a name="_a1"></a><a class="code" href="structcfg__opt__t.html">cfg_opt_t</a> arg_opts[] = {
        <a name="a2"></a><a class="code" href="confuse_8h.html#a15">CFG_STR</a>(<span class="stringliteral">"value"</span>, <span class="stringliteral">"default"</span>, CFGF_NONE),
        <a name="a3"></a><a class="code" href="confuse_8h.html#a47">CFG_END</a>()
    };
    <a class="code" href="structcfg__opt__t.html">cfg_opt_t</a> opts[] = {
        <a name="a4"></a><a class="code" href="confuse_8h.html#a22">CFG_INT</a>(<span class="stringliteral">"delay"</span>, 3, CFGF_NONE),
        <a class="code" href="confuse_8h.html#a15">CFG_STR</a>(<span class="stringliteral">"message"</span>, <span class="stringliteral">"This is a message"</span>, CFGF_NONE),
        <a name="a5"></a><a class="code" href="confuse_8h.html#a41">CFG_SEC</a>(<span class="stringliteral">"argument"</span>, arg_opts, CFGF_MULTI | CFGF_TITLE),
        <a class="code" href="confuse_8h.html#a47">CFG_END</a>()
    };
    <span class="keywordtype">int</span> ret;

    <span class="keywordtype">char</span> *buf = <span class="stringliteral">""</span> \
        <span class="stringliteral">" delay = 3\n"</span> \
        <span class="stringliteral">"# message = \"asdfasfasfd tersf\"\n"</span> \
        <span class="stringliteral">" argument one { value = 1 }\n"</span> \
        <span class="stringliteral">" argument two { value=foo}\n"</span>;

    <a name="a6"></a>cfg_free(cfg);

    cfg = <a name="a7"></a>cfg_init(opts, 0);
    ret = <a name="a8"></a>cfg_parse_buf(cfg, buf);
    ret = <a name="a9"></a>cfg_parse(cfg, config_filename);
}

<span class="keywordtype">void</span> sighandler(<span class="keywordtype">int</span> sig)
{
    read_config();
    signal(SIGHUP, sighandler);
}

<span class="keyword">static</span> <span class="keywordtype">int</span> loop = 1;

<span class="keywordtype">void</span> usr1handler(<span class="keywordtype">int</span> sig)
{
    loop = 0;
}

<span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)
{
    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;

    read_config();
    signal(SIGHUP, sighandler);
    signal(SIGUSR1, usr1handler);

    <span class="keywordflow">while</span>(loop)
    {
        printf(<span class="stringliteral">"Message: %s"</span>, <a name="a10"></a>cfg_getstr(cfg, <span class="stringliteral">"message"</span>));
        <span class="keywordflow">for</span>(i = 0; i &lt; <a name="a11"></a>cfg_size(cfg, <span class="stringliteral">"argument"</span>); i++)
        {
            <a class="code" href="structcfg__t.html">cfg_t</a> *arg = <a name="a12"></a>cfg_getnsec(cfg, <span class="stringliteral">"argument"</span>, i);
            printf(<span class="stringliteral">", %s"</span>, cfg_getstr(arg, <span class="stringliteral">"value"</span>));
        }
        printf(<span class="stringliteral">"\n"</span>);

        sleep(<a name="a13"></a>cfg_getint(cfg, <span class="stringliteral">"delay"</span>));
    }

    cfg_free(cfg);
    cfg = 0;

    <span class="keywordflow">return</span> 0;
}
</div></pre><pre><div class="fragment">00001 <span class="preprocessor">#include "<a class="code" href="confuse_8h.html">confuse.h</a>"</span>
00002 <span class="preprocessor">#include &lt;string.h&gt;</span>
00003 <span class="preprocessor">#include &lt;signal.h&gt;</span>
00004 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
00005 
00006 <a class="code" href="structcfg__t.html">cfg_t</a> *cfg = 0;
00007 <span class="keyword">const</span> <span class="keywordtype">char</span> *config_filename = <span class="stringliteral">"./reread.conf"</span>;
00008 
00009 <span class="keywordtype">void</span> read_config(<span class="keywordtype">void</span>)
00010 {
00011     <a class="code" href="structcfg__opt__t.html">cfg_opt_t</a> arg_opts[] = {
00012         <a class="code" href="confuse_8h.html#a15">CFG_STR</a>(<span class="stringliteral">"value"</span>, <span class="stringliteral">"default"</span>, CFGF_NONE),
00013         <a class="code" href="confuse_8h.html#a47">CFG_END</a>()
00014     };
00015     <a class="code" href="structcfg__opt__t.html">cfg_opt_t</a> opts[] = {
00016         <a class="code" href="confuse_8h.html#a22">CFG_INT</a>(<span class="stringliteral">"delay"</span>, 3, CFGF_NONE),
00017         <a class="code" href="confuse_8h.html#a15">CFG_STR</a>(<span class="stringliteral">"message"</span>, <span class="stringliteral">"This is a message"</span>, CFGF_NONE),
00018         <a class="code" href="confuse_8h.html#a41">CFG_SEC</a>(<span class="stringliteral">"argument"</span>, arg_opts, CFGF_MULTI | CFGF_TITLE),
00019         <a class="code" href="confuse_8h.html#a47">CFG_END</a>()
00020     };
00021     <span class="keywordtype">int</span> ret;
00022 
00023     <span class="keywordtype">char</span> *buf = <span class="stringliteral">""</span> \
00024         <span class="stringliteral">" delay = 3\n"</span> \
00025         <span class="stringliteral">"# message = \"asdfasfasfd tersf\"\n"</span> \
00026         <span class="stringliteral">" argument one { value = 1 }\n"</span> \
00027         <span class="stringliteral">" argument two { value=foo}\n"</span>;
00028 
00029     cfg_free(cfg);
00030 
00031     cfg = cfg_init(opts, 0);
00032     ret = cfg_parse_buf(cfg, buf);
00033     ret = cfg_parse(cfg, config_filename);
00034 }
00035 
00036 <span class="keywordtype">void</span> sighandler(<span class="keywordtype">int</span> sig)
00037 {
00038     read_config();
00039     signal(SIGHUP, sighandler);
00040 }
00041 
00042 <span class="keyword">static</span> <span class="keywordtype">int</span> loop = 1;
00043 
00044 <span class="keywordtype">void</span> usr1handler(<span class="keywordtype">int</span> sig)
00045 {
00046     loop = 0;
00047 }
00048 
00049 <span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)
00050 {
00051     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
00052 
00053     read_config();
00054     signal(SIGHUP, sighandler);
00055     signal(SIGUSR1, usr1handler);
00056 
00057     <span class="keywordflow">while</span>(loop)
00058     {
00059         printf(<span class="stringliteral">"Message: %s"</span>, cfg_getstr(cfg, <span class="stringliteral">"message"</span>));
00060         <span class="keywordflow">for</span>(i = 0; i &lt; cfg_size(cfg, <span class="stringliteral">"argument"</span>); i++)
00061         {
00062             <a class="code" href="structcfg__t.html">cfg_t</a> *arg = cfg_getnsec(cfg, <span class="stringliteral">"argument"</span>, i);
00063             printf(<span class="stringliteral">", %s"</span>, cfg_getstr(arg, <span class="stringliteral">"value"</span>));
00064         }
00065         printf(<span class="stringliteral">"\n"</span>);
00066 
00067         sleep(cfg_getint(cfg, <span class="stringliteral">"delay"</span>));
00068     }
00069 
00070     cfg_free(cfg);
00071     cfg = 0;
00072 
00073     <span class="keywordflow">return</span> 0;
00074 }
</div></pre> <!-- doxygen-footer.html starts here -->
  </div>
 </body>
</html>
